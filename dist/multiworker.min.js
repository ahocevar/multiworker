!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.MultiWorker=e()}}(function(){return function e(t,n,i){function r(o,a){if(!n[o]){if(!t[o]){var u="function"==typeof require&&require;if(!a&&u)return u(o,!0);if(s)return s(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return r(n?n:e)},f,f.exports,e,t,n,i)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=0,s=function o(){i(this,o),this.id=r++,this.done=!1};t.exports=s},{}],2:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function s(e,t,n){i(this,s),this.event=n,this.done=!!t.done,this.instance=e};t.exports=r},{}],3:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=e("./util"),o=e("./Post"),a=e("./WorkerMessage"),u=e("./workerString"),c=new WeakMap,f=function(){function e(t){var n=this;i(this,e);var r=void 0!==t.worker?t.worker:t;"string"==typeof r?s.get(r,function(e){n.worker=e,n._init()}):"function"==typeof r&&(this.worker=s.functionToInstantString(r)),this.callback=t.callback||s.noop,this.threads=t.threads||1,this.dependencies=t.dependencies||[],this._initProperties(),this.worker&&this._init()}return r(e,[{key:"post",value:function(){var e=Array.prototype.slice.call(arguments),t="function"==typeof e[e.length-1]?e.pop():this.callback;return this._process(e,t),this}},{key:"terminate",value:function(){var e=arguments.length<=0||void 0===arguments[0]?!1:arguments[0],t=arguments[1];return"function"==typeof e&&(t=e,e=!1),e||this.ready&&!this.processCount?(this.workerList.forEach(function(e){return e.terminate()}),this._initProperties(),this.threads=0,delete this.terminateWhenFree,"function"==typeof t&&t()):this.terminateWhenFree=t||!0,this}},{key:"_init",value:function(){this.ready=!0,this._initThreads(),this._processQueue()}},{key:"_process",value:function(e,t){var n=this._availableWorker,i=new o;e.push(i),this.ready&&n?(this._inProgressData[i.id]={cb:t,worker:n},n.postMessage(e),c.set(n,!0),this.processCount++):this.queue.push([e,t])}},{key:"_initProperties",value:function(){this.ready=!1,this.workerList=[],this.queue=[],this.processCount=0,this._inProgressData={}}},{key:"_initThreads",value:function(){for(var e=this.threads;e--;){var t=new Worker(this._blobUrl);t.addEventListener("message",this.constructor._defaultMessageEvent.bind(this),!1),this.workerList.push(t)}}},{key:"_processFinished",value:function(e){this.processCount--;var t=this._inProgressData[e].worker;return c.set(t,!1),delete this._inProgressData[e],this}},{key:"_processQueue",value:function(){if(this.queue.length&&this.processCount<this.threads){var e=this.queue.shift();this._process.apply(this,e),this._processQueue()}else this.terminateWhenFree&&!this.processCount&&this.terminate(!0,this.terminateWhenFree);return this}},{key:"_availableWorker",get:function(){for(var e=this.workerList,t=0,n=e.length;n>t;t++)if(!c.get(e[t]))return e[t];return!1}},{key:"_workerString",get:function(){return u.replace("'__MultiWorker_placeholder__';",this._dependencyString+this.worker)}},{key:"_blobUrl",get:function(){return this._blobUrlCached||(this._blobUrlCached=window.URL.createObjectURL(new Blob([this._workerString],{type:"application/javascript"}))),this._blobUrlCached}},{key:"_dependencyString",get:function(){return s.stringifyFunctionList(this.dependencies)}}],[{key:"_defaultMessageEvent",value:function(e){var t=e.data.pop(),n=this._inProgressData[t.id].cb,i=new a(this,t,e);t.done&&this._processFinished(t.id),n.apply(i,e.data),t.done&&this._processQueue()}}]),e}();t.exports=f},{"./Post":1,"./WorkerMessage":2,"./util":4,"./workerString":5}],4:[function(e,t,n){"use strict";function i(e){return"("+e.toString()+")();"}function r(e){return e.reduce(function(e,t){return e+t.toString()+";"},"")}function s(){}function o(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){4===n.readyState&&200===n.status&&t(n.responseText)},n.open("GET",e,!0),n.send()}Object.defineProperty(n,"__esModule",{value:!0}),n.functionToInstantString=i,n.stringifyFunctionList=r,n.noop=s,n.get=o},{}],5:[function(e,t,n){"use strict";var i=e("./util");t.exports=i.functionToInstantString(function(){!function(){function e(){var e=Array.prototype.slice.call(arguments);t.done=e.shift(),e.push(t),postMessage(e)}var t=void 0;self["return"]=e.bind(this,!0),self.post=e.bind(this,!1),self.addEventListener("message",function(e){t=e.data.pop(),self.receive.apply(e,e.data)},!1)}()})},{"./util":4}]},{},[3])(3)});